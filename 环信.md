###环信
    接入文档：
http://docs.easemob.com/im/start


 1、登陆

 思路：先用自己的接口验证登陆，如果成功则继续验证环信登录，如果成功的话则全部登录成功。

```

- (IBAction)login:(UIButton *)sender {

 NSString *userName = self.userName.text;

 NSString *password = self.password.text;

 if (self.userName.text.length==0) {

 TTAlertNoTitle(@"用户名不能为空");

 return;

 }



 if (self.password.text.length==0) {

 TTAlertNoTitle(@"密码不能为空");

 return;

 }



 [self showHudInView:self.view hint:@"正在登录"];



 NSDictionary *parameters = @{@"identity": @"doctor",@"key":[userName lowercaseString],@"password":[[MyMD5 md5:password]uppercaseString]};

 [AFNetPackage postJSONWithUrl:LoginUrl parameters:parameters success:^(id responseObject)

 {

 NSDictionary *dict=[NSJSONSerialization JSONObjectWithData:responseObject options:NSJSONReadingMutableLeaves error:nil];



 if ([dict[@"status"] integerValue]==610) {

 [self hideHud];

 TTAlertNoTitle(@"账号或密码错误!");

 }

 else{

 NSDictionary *dicInfo=[dict objectForKey:@"data"];

 NSString *huanxin_id=[dicInfo objectForKey:@"huanxinId"];

 NSString *huanxin_pwd=[dicInfo objectForKey:@"huanxinPwd"];

 //异步登陆账号



 [[EaseMob sharedInstance].chatManager asyncLoginWithUsername:huanxin_id



 password:huanxin_pwd

 completion:

 ^(NSDictionary *loginInfo, EMError *error) {

 [self hideHud];

 if (loginInfo && !error) {

 [self loadInfoAndSaveUserDefault];

 [[EaseMob sharedInstance].chatManager setIsAutoLoginEnabled:YES];

 [[EaseMob sharedInstance].chatManager importDataToNewDatabase];

 [[EaseMob sharedInstance].chatManager loadDataFromDatabase];

 [[EaseMob sharedInstance].chatManager asyncFetchMyGroupsList];



 //发送自动登陆状态通知

 [[NSNotificationCenter defaultCenter] postNotificationName:KNOTIFICATION_LOGINCHANGE object:@YES];

 [JPUSHService setTags:nil alias:huanxin_id fetchCompletionHandle:nil];

 }

 } onQueue:nil];



 }

 } fail:^{

 [self hideHud];

 TTAlertNoTitle(@"网络错误");

 }];

}

```

 注意：环信需要设置。在AppDelegate+EaseMob.m文件中

```

 [[EaseMob sharedInstance] registerSDKWithAppKey:@"knight#hplatform"

 apnsCertName:@"yhdoctor"

 otherConfig:@{kSDKConfigEnableConsoleLogger:@YES}];

```
