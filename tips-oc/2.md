##内存管理##

1、操作系统内存

    5个区域：栈区、堆区、BSS、数据区、代码区。
    （1）、存放局部变量
    （2）、存放程序运行会随机分配的空间
    （3）、存放全局未初始化的全局变量和静态变量
    （4）、存放已经初始化的全局变量和静态变量和字符串
    （5）、存放代码
    ￼

￼![](/assets/screenshot.png)


2、objective-c内存管理
    
    只管理用new初始化的对象，也就是继承自NSObject的对象。堆中的数据

3、内存管理的原理

    对象的所有权及引用计数。任何对象都可能拥有一个或多个所有者。只要一个对象至少有一个拥有者，它就继续存在。
    可以通过retain获得对象的所有权。但是存在一种特殊情况，比如当对象的值为nil时，引用计数器为0，但是它不释放空间。
    Person *p = nil;此时retainCount为0，且对象为nil但是不回收内存，因为该对象根本没初始化，没有分配空间也就没有办法回收空间。
    
4、对象的销毁

    当一个对象的引用计数器为0时，它将被销毁，释放其占用的内存，且系统会自动向对        象发送一条dealloc消息，一般会重写dealloc方法，重写dealloc方法必须要写[super dealloc];并且放在代码的最后。如果坚持使用释放的内存则会造成程序奔溃（野指针错误）
    
```
-(void)dealloc{
    NSLog(@"释放");
    [Super dealloc];
}

```


5、OC内存管理的分类
    
    MRC（MannulReference Counting，手动内存管理）、ARC（Automatic reference counting，自动引用计数）、garbage collection（垃圾回收，iOS不支持垃圾回收）。ARC作为苹果新提供的技术，推荐开发者使用来管理内存。
    
6、内存管理的原则

    谁初始化了内存谁负责释放；谁retain谁release；一个对象的引用计数器在使用之前是几当你使用完之后引用计数器还得是几，保持之前的引用计数。
    
7、


    
    
    
    
    

3、ARC代码例子

```
NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
Person *person = [[Person alloc] init];
NSLog(@"对象person的retainCount: %zd",[person retainCount] );[person autorelease];
NSLog(@"对象person的retainCount: %zd",[person retainCount] );
NSLog(@"到这里，person还没被释放");
[pool release];
```

